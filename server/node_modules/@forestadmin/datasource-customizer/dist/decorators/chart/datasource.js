"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const collection_1 = __importDefault(require("./collection"));
const result_builder_1 = __importDefault(require("./result-builder"));
const agent_context_1 = __importDefault(require("../../context/agent-context"));
const datasource_decorator_1 = __importDefault(require("../datasource-decorator"));
class ChartDataSourceDecorator extends datasource_decorator_1.default {
    get schema() {
        const myCharts = Object.keys(this.charts);
        const otherCharts = this.childDataSource.schema.charts;
        const duplicate = myCharts.find(name => otherCharts.includes(name));
        if (duplicate)
            throw new Error(`Chart '${duplicate}' is defined twice.`);
        return { ...this.childDataSource.schema, charts: [...myCharts, ...otherCharts] };
    }
    constructor(childDataSource) {
        super(childDataSource, collection_1.default);
        this.charts = {};
    }
    addChart(name, definition) {
        if (this.schema.charts.includes(name)) {
            throw new Error(`Chart '${name}' already exists.`);
        }
        this.charts[name] = definition;
    }
    async renderChart(caller, name) {
        const chartDefinition = this.charts[name];
        if (chartDefinition) {
            return chartDefinition(new agent_context_1.default(this, caller), new result_builder_1.default());
        }
        return super.renderChart(caller, name);
    }
}
exports.default = ChartDataSourceDecorator;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YXNvdXJjZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kZWNvcmF0b3JzL2NoYXJ0L2RhdGFzb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFFQSw4REFBb0Q7QUFDcEQsc0VBQTZDO0FBRTdDLGdGQUFvRTtBQUNwRSxtRkFBMEQ7QUFFMUQsTUFBcUIsd0JBQXlCLFNBQVEsOEJBQTZDO0lBR2pHLElBQWEsTUFBTTtRQUNqQixNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMxQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFFdkQsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNwRSxJQUFJLFNBQVM7WUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLFVBQVUsU0FBUyxxQkFBcUIsQ0FBQyxDQUFDO1FBRXpFLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxDQUFDLEdBQUcsUUFBUSxFQUFFLEdBQUcsV0FBVyxDQUFDLEVBQUUsQ0FBQztJQUNuRixDQUFDO0lBRUQsWUFBWSxlQUEyQjtRQUNyQyxLQUFLLENBQUMsZUFBZSxFQUFFLG9CQUF3QixDQUFDLENBQUM7UUFiM0MsV0FBTSxHQUE4QyxFQUFFLENBQUM7SUFjL0QsQ0FBQztJQUVELFFBQVEsQ0FBQyxJQUFZLEVBQUUsVUFBcUM7UUFDMUQsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDckMsTUFBTSxJQUFJLEtBQUssQ0FBQyxVQUFVLElBQUksbUJBQW1CLENBQUMsQ0FBQztTQUNwRDtRQUVELElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsVUFBVSxDQUFDO0lBQ2pDLENBQUM7SUFFUSxLQUFLLENBQUMsV0FBVyxDQUFDLE1BQWMsRUFBRSxJQUFZO1FBQ3JELE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFMUMsSUFBSSxlQUFlLEVBQUU7WUFDbkIsT0FBTyxlQUFlLENBQUMsSUFBSSx1QkFBeUIsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLEVBQUUsSUFBSSx3QkFBYSxFQUFFLENBQUMsQ0FBQztTQUMxRjtRQUVELE9BQU8sS0FBSyxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDekMsQ0FBQztDQUNGO0FBbENELDJDQWtDQyJ9