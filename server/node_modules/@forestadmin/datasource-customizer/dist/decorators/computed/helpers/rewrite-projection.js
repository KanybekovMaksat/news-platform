"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const datasource_toolkit_1 = require("@forestadmin/datasource-toolkit");
function rewriteField(collection, path) {
    // Projection is targeting a field on another collection => recurse.
    if (path.includes(':')) {
        const [prefix] = path.split(':');
        const schema = collection.schema.fields[prefix];
        const association = collection.dataSource.getCollection(schema.foreignCollection);
        return new datasource_toolkit_1.Projection(path)
            .unnest()
            .replace(subPath => rewriteField(association, subPath))
            .nest(prefix);
    }
    // Computed field that we own: recursively replace by dependencies
    const computed = collection.getComputed(path);
    return computed
        ? new datasource_toolkit_1.Projection(...computed.dependencies).replace(depPath => rewriteField(collection, depPath))
        : new datasource_toolkit_1.Projection(path);
}
exports.default = rewriteField;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmV3cml0ZS1wcm9qZWN0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2RlY29yYXRvcnMvY29tcHV0ZWQvaGVscGVycy9yZXdyaXRlLXByb2plY3Rpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx3RUFBNkU7QUFJN0UsU0FBd0IsWUFBWSxDQUFDLFVBQThCLEVBQUUsSUFBWTtJQUMvRSxvRUFBb0U7SUFDcEUsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1FBQ3RCLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sTUFBTSxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBbUIsQ0FBQztRQUNsRSxNQUFNLFdBQVcsR0FBRyxVQUFVLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUVsRixPQUFPLElBQUksK0JBQVUsQ0FBQyxJQUFJLENBQUM7YUFDeEIsTUFBTSxFQUFFO2FBQ1IsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQzthQUN0RCxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDakI7SUFFRCxrRUFBa0U7SUFDbEUsTUFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUU5QyxPQUFPLFFBQVE7UUFDYixDQUFDLENBQUMsSUFBSSwrQkFBVSxDQUFDLEdBQUcsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDaEcsQ0FBQyxDQUFDLElBQUksK0JBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUMzQixDQUFDO0FBbkJELCtCQW1CQyJ9