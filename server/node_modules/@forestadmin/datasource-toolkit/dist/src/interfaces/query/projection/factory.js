"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const _1 = __importDefault(require("."));
class ProjectionFactory {
    static all(collection) {
        const schemaFields = collection.schema.fields;
        const projectionFields = Object.entries(schemaFields).reduce((memo, [columnName, column]) => {
            if (column.type === 'Column') {
                return [...memo, columnName];
            }
            if (column.type === 'OneToOne' || column.type === 'ManyToOne') {
                const relation = collection.dataSource.getCollection(column.foreignCollection);
                const relationFields = relation.schema.fields;
                return [
                    ...memo,
                    ...Object.keys(relationFields)
                        .filter(relColumnName => relationFields[relColumnName].type === 'Column')
                        .map(relColumnName => `${columnName}:${relColumnName}`),
                ];
            }
            return memo;
        }, []);
        return new _1.default(...projectionFields);
    }
    static columns(collection) {
        return new _1.default(...Object.keys(collection.schema.fields).filter(f => collection.schema.fields[f].type === 'Column'));
    }
}
exports.default = ProjectionFactory;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9pbnRlcmZhY2VzL3F1ZXJ5L3Byb2plY3Rpb24vZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLHlDQUEyQjtBQUczQixNQUFxQixpQkFBaUI7SUFDcEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFzQjtRQUMvQixNQUFNLFlBQVksR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUM5QyxNQUFNLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxFQUFFLEVBQUU7WUFDMUYsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLFFBQVEsRUFBRTtnQkFDNUIsT0FBTyxDQUFDLEdBQUcsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO2FBQzlCO1lBRUQsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLFVBQVUsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLFdBQVcsRUFBRTtnQkFDN0QsTUFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUM7Z0JBQy9FLE1BQU0sY0FBYyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO2dCQUU5QyxPQUFPO29CQUNMLEdBQUcsSUFBSTtvQkFDUCxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDO3lCQUMzQixNQUFNLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQzt5QkFDeEUsR0FBRyxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsR0FBRyxVQUFVLElBQUksYUFBYSxFQUFFLENBQUM7aUJBQzFELENBQUM7YUFDSDtZQUVELE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxFQUFFLEVBQWMsQ0FBQyxDQUFDO1FBRW5CLE9BQU8sSUFBSSxVQUFVLENBQUMsR0FBRyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQzdDLENBQUM7SUFFRCxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQXNCO1FBQ25DLE9BQU8sSUFBSSxVQUFVLENBQ25CLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FDN0MsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssUUFBUSxDQUNuRCxDQUNGLENBQUM7SUFDSixDQUFDO0NBQ0Y7QUFqQ0Qsb0NBaUNDIn0=